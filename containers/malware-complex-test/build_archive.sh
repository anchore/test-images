#!/bin/bash

# This script is used to re-build the scan test archive file to allow consistent reconstruction

payload1=./scanner_test_msshellcode.40_payload
payload2=./scanner_test_eicar.com_payload
payload3=./scanner_test_combined_payload

dir1=test_archive
dir2=nestedlongdirectoryname
dir3=veryverylongnesteddirectoryname

# Create a deep enough nesting structure that output of the path will be long enough to trigger clamav path truncdtion in output
full_path=${dir1}/${dir2}/${dir3}/${dir3}
mkdir -p ${full_path}

# Add all payloads to first level
cp ${payload1} ${dir1}/
cp ${payload2} ${dir1}/
cp ${payload3} ${dir1}/

# Add to the deep nesting for testing long paths
cp ${payload1} ${full_path}/
cp ${payload2} ${full_path}/

echo building archive
pushd ${dir1}
tar -a -cvf ../malware_payload_test_archive.tar.gz .
popd
echo cleaning up ${dir1}
rm -rf ${dir1}

